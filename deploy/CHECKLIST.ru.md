# Pre-Deploy Checklist

## ‚úÖ –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –¥–µ–ø–ª–æ–µ–º

### –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
- [ ] –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ Git
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫: `cd frontend && npm run build`
- [ ] `.env.example` –æ–±–Ω–æ–≤–ª–µ–Ω —Å–æ –≤—Å–µ–º–∏ –Ω—É–∂–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### –ù–∞ VPS
- [ ] Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `docker --version`
- [ ] Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `docker compose version`
- [ ] Node.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `node --version` (>= 18.0.0)
- [ ] Git —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `git --version`
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É docker: `groups | grep docker`

### DNS –∏ –¥–æ–º–µ–Ω
- [ ] –î–æ–º–µ–Ω –∫—É–ø–ª–µ–Ω
- [ ] A-–∑–∞–ø–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP VPS
- [ ] DNS –ø—Ä–æ–ø–∞–≥–∏—Ä–æ–≤–∞–ª—Å—è: `dig –≤–∞—à-–¥–æ–º–µ–Ω.ru +short` ‚Üí IP VPS

### Firewall
- [ ] –ü–æ—Ä—Ç 22 –æ—Ç–∫—Ä—ã—Ç (SSH)
- [ ] –ü–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç (HTTP)
- [ ] –ü–æ—Ä—Ç 443 –æ—Ç–∫—Ä—ã—Ç (HTTPS)
- [ ] –ü–æ—Ä—Ç—ã 8080, 5432 –∑–∞–∫—Ä—ã—Ç—ã (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [ ] –§–∞–π–ª `.env` —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω:
  - [ ] `DOMAIN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
  - [ ] `EMAIL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
  - [ ] `POSTGRES_PASSWORD` - —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
  - [ ] `DATABASE_URL` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–∞—Ä–æ–ª—é
  - [ ] `JWT_SECRET_KEY` - —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
  - [ ] `SERVER_DEBUG=False`
  - [ ] `SERVER_RELOAD=False`

## ‚úÖ –ü–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º (re-deploy)

- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –≤ Git
- [ ] –°–¥–µ–ª–∞–Ω –±—ç–∫–∞–ø –ë–î (–µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª—è—Ö)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic (–µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î)
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

## ‚úÖ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

- [ ] –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker compose ps`
- [ ] –°–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è: `https://–≤–∞—à-–¥–æ–º–µ–Ω.ru`
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–µ–Ω (–∑–µ–ª–µ–Ω—ã–π –∑–∞–º–æ—á–µ–∫)
- [ ] API —Ä–∞–±–æ—Ç–∞–µ—Ç: `curl https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/`
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö: `./deploy/deploy.sh logs`
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –°—Ç–∞—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üîç –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
docker compose ps | grep Up

# –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
docker compose logs --tail=100 | grep -i error

# Nginx –∫–æ–Ω—Ñ–∏–≥ –≤–∞–ª–∏–¥–µ–Ω
docker compose exec nginx nginx -t

# –°–∞–π—Ç –æ—Ç–≤–µ—á–∞–µ—Ç
curl -I https://–≤–∞—à-–¥–æ–º–µ–Ω.ru

# API –æ—Ç–≤–µ—á–∞–µ—Ç
curl https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/
```

## üö® –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ: `docker compose down`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞: `./deploy/deploy.sh deploy`

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ç–∫–∞–ø–∞

```bash
# –ë—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
docker compose exec db pg_dump -U reflectly_user reflectly > backup_$(date +%Y%m%d_%H%M%S).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)
docker compose exec -T db psql -U reflectly_user reflectly < backup_YYYYMMDD_HHMMSS.sql
```

## üìù –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

```bash
# JWT Secret
openssl rand -hex 32

# Postgres Password
openssl rand -base64 32
```
